<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>Trackerton</title>
  <link rel="stylesheet" href="../output.css">
  <style>
    :root {
      /* Light Theme - Victorian Cream & Sepia */
      --bg-body: transparent;
      --text-primary: #2d2520;
      --text-secondary: #6b5745;
      --text-label: #8b7355;
      
      --card-bg: #fdfbf7;
      --card-border: #8b7355;
      --card-shadow: rgba(139, 115, 85, 0.2);
      
      --header-gradient-start: #8b7355;
      --header-gradient-mid: #6b5745;
      --header-gradient-end: #4a3f35;
      --header-text: #fdfbf7;
      
      --button-bg: rgba(90, 74, 58, 0.35);
      --button-border: rgba(253, 251, 247, 0.6);
      --button-hover-bg: rgba(107, 87, 69, 0.5);
      
      --badge-border: rgba(139, 115, 85, 0.5);
      --badge-bg: rgba(253, 251, 247, 0.25);
      --badge-running-border: rgba(90, 138, 90, 0.7);
      --badge-running-bg: rgba(90, 138, 90, 0.25);
      --badge-running-text: #d4f1d4;
      --badge-paused-border: rgba(184, 148, 90, 0.7);
      --badge-paused-bg: rgba(184, 148, 90, 0.25);
      --badge-paused-text: #f5e8c8;
      
      --timer-bg: linear-gradient(135deg, #f5f1e8 0%, #e8ddc8 100%);
      --timer-border: #8b7355;
      --timer-text: #2d2520;
      
      --prompt-border: rgba(139, 115, 85, 0.6);
      --prompt-bg: rgba(245, 241, 232, 0.7);
      --prompt-text: #4a3f35;
      
      --button-green: #5a8a5a;
      --button-green-hover: #4a7a4a;
      --button-red: #a85a5a;
      --button-red-hover: #984a4a;
      
      --link-color: #8b7355;
      --link-hover: #6b5745;
    }

    [data-theme="dark"] {
      /* Dark Theme - Warmer, Lighter Browns */
      --bg-body: #2d2520;
      --text-primary: #f5f1e8;
      --text-secondary: #d4c5a9;
      --text-label: #b8a58a;
      
      --card-bg: #3a3028;
      --card-border: #6b5745;
      --card-shadow: rgba(0, 0, 0, 0.4);
      
      --header-gradient-start: #6b5745;
      --header-gradient-mid: #5a4a3a;
      --header-gradient-end: #4a3f35;
      --header-text: #f5f1e8;
      
      --button-bg: rgba(107, 87, 69, 0.45);
      --button-border: rgba(245, 241, 232, 0.5);
      --button-hover-bg: rgba(139, 115, 85, 0.6);
      
      --badge-border: rgba(139, 115, 85, 0.6);
      --badge-bg: rgba(90, 74, 58, 0.3);
      --badge-running-border: rgba(106, 154, 106, 0.8);
      --badge-running-bg: rgba(106, 154, 106, 0.3);
      --badge-running-text: #d4f1d4;
      --badge-paused-border: rgba(200, 164, 106, 0.8);
      --badge-paused-bg: rgba(200, 164, 106, 0.3);
      --badge-paused-text: #f5e8c8;
      
      --timer-bg: linear-gradient(135deg, #3a3028 0%, #2d2520 100%);
      --timer-border: #6b5745;
      --timer-text: #fdfbf7;
      
      --prompt-border: rgba(139, 115, 85, 0.5);
      --prompt-bg: rgba(45, 37, 32, 0.7);
      --prompt-text: #d4c5a9;
      
      --button-green: #6a9a6a;
      --button-green-hover: #5a8a5a;
      --button-red: #b86a6a;
      --button-red-hover: #a85a5a;
      
      --link-color: #b8a58a;
      --link-hover: #d4c5a9;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
    }

    body {
      padding: 8px;
      -webkit-app-region: drag;
      background: transparent;
      color: #2d2520;
      font-family: 'Georgia', 'Times New Roman', serif;
      display: flex;
      align-items: flex-start;
      justify-content: center;
    }

    @media (prefers-color-scheme: dark) {
      body {
        color: #f5f1e8;
      }
    }

    button, select, input {
      -webkit-app-region: no-drag;
    }

    .menu-bar-card {
      width: 100%;
      max-width: 320px;
      background: var(--card-bg);
      border-radius: 16px;
      border: 3px solid var(--card-border);
      box-shadow: 0 18px 34px var(--card-shadow),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .menu-card__header {
      background: linear-gradient(140deg, var(--header-gradient-start) 0%, var(--header-gradient-mid) 50%, var(--header-gradient-end) 100%);
      color: var(--header-text);
      padding: 14px 18px;
      border-bottom: 3px solid var(--card-border);
      box-shadow: 0 2px 8px var(--card-shadow);
    }

    .menu-card__header-top,
    .menu-card__title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .menu-card__title-row {
      margin-top: 6px;
    }

    .menu-card__title {
      font-size: 17px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .menu-card__eyebrow {
      font-size: 11px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      opacity: 0.85;
      font-weight: 700;
      font-family: 'Courier New', monospace;
    }

        .header-icon-button {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: var(--button-bg);
      border: 2px solid var(--button-border);
      color: var(--header-text);
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      transition: background 180ms ease, border-color 180ms ease, transform 100ms ease;
      box-shadow: 0 2px 6px var(--card-shadow);
    }

    .header-icon-button:hover {
      background: var(--button-hover-bg);
      border-color: var(--header-text);
      transform: translateY(-1px);
    }

    .header-icon-button:active {
      background: var(--button-hover-bg);
      transform: translateY(0);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      border-radius: 9999px;
      border: 2px solid var(--badge-border);
      background: var(--badge-bg);
      padding: 3px 12px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      font-family: 'Courier New', monospace;
      color: var(--header-text);
    }

    .status-badge.status-running {
      border-color: var(--badge-running-border);
      background: var(--badge-running-bg);
      color: var(--badge-running-text);
    }

    .status-badge.status-paused {
      border-color: var(--badge-paused-border);
      background: var(--badge-paused-bg);
      color: var(--badge-paused-text);
    }

    .menu-card__content {
      padding: 16px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .task-block__label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-label);
      margin-bottom: 6px;
      font-weight: 700;
      font-family: 'Courier New', monospace;
    }

    .task-block__name {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
      font-family: Georgia, 'Times New Roman', serif;
    }

    .task-block__context {
      font-size: 12px;
      color: var(--text-label);
      margin-top: 2px;
      font-family: Georgia, serif;
    }

    .timer-block {
      text-align: center;
    }

    .timer-block__display {
      font-size: 32px;
      font-family: 'Courier New', monospace;
      font-weight: 700;
      color: var(--timer-text);
      letter-spacing: 0.15em;
      background: var(--timer-bg);
      border: 3px solid var(--timer-border);
      border-radius: 12px;
      padding: 14px 20px;
      box-shadow: inset 0 2px 6px var(--card-shadow), 
                  0 4px 12px var(--card-shadow);
      display: inline-block;
    }

    .timer-block__label {
      margin-top: 6px;
      font-size: 10px;
      letter-spacing: 0.32em;
      text-transform: uppercase;
      color: var(--text-label);
      font-family: 'Courier New', monospace;
      font-weight: 700;
    }

    .prompt-block {
      border: 2px dashed var(--prompt-border);
      background: var(--prompt-bg);
      border-radius: 14px;
      padding: 14px;
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 10px;
      color: var(--prompt-text);
      font-family: Georgia, serif;
    }

    .prompt-block__text {
      font-size: 12px;
      line-height: 1.45;
    }

    .timer-button-group {
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .timer-button {
      min-width: 100px;
      padding: 10px 16px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      border: 2px solid;
      color: #fdfbf7;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
      box-shadow: 0 4px 10px rgba(45, 37, 32, 0.3);
      font-family: Georgia, serif;
      text-shadow: 0 1px 2px rgba(45, 37, 32, 0.4);
    }

    .timer-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(45, 37, 32, 0.4);
    }

    .timer-button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      box-shadow: none;
    }

    .timer-button--start {
      background: linear-gradient(140deg, var(--button-green) 0%, var(--button-green-hover) 100%);
      border-color: var(--button-green-hover);
    }

    .timer-button--stop {
      background: linear-gradient(140deg, var(--button-red) 0%, var(--button-red-hover) 100%);
      border-color: var(--button-red-hover);
    }

    .link-button {
      background: none;
      border: none;
      color: var(--link-color);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      cursor: pointer;
      transition: color 0.12s ease;
      font-family: 'Courier New', monospace;
    }

    .link-button:hover {
      color: var(--link-hover);
      text-decoration: underline;
    }

    .link-button--filled {
      background: #111827;
      color: #f8fafc;
      border-radius: 12px;
      padding: 10px 16px;
      width: 100%;
      text-align: center;
      letter-spacing: 0.12em;
    }

    @media (prefers-color-scheme: dark) {
      .timer-button { box-shadow: none; }
      .link-button { color: #cbd5f5; }
      .link-button:hover { color: #f8fafc; }
      .link-button--filled { background: #cbd5f5; color: #0f172a; }
    }

    .control-group {
      display: none;
      flex-direction: column;
      gap: 10px;
    }

    .control-group.is-visible {
      display: flex;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="menu-bar-card">
    <div class="menu-card__header">
      <div class="menu-card__header-top">
        <div class="menu-card__eyebrow">Trackerton</div>
        <button id="openMainWindowHeader" class="header-icon-button" aria-label="Open Main Window">↗</button>
      </div>
      <div class="menu-card__title-row">
        <span class="menu-card__title">Quick Timer</span>
        <span id="statusBadge" class="status-badge status-idle">Idle</span>
      </div>
    </div>

    <div class="menu-card__content" id="cardContent">
      <!-- Current Task Display -->
      <section>
        <div class="task-block__label">Current Task</div>
        <div id="currentTask" class="task-block__name">
          No task selected
        </div>
        <p id="taskContext" class="task-block__context"></p>
      </section>

      <!-- Timer Display -->
      <section class="timer-block">
        <div id="timerDisplay" class="timer-block__display">
          00:00:00
        </div>
        <div class="timer-block__label">Elapsed Time</div>
      </section>

      <!-- No Task Prompt -->
      <div id="noTaskPrompt" class="prompt-block">
        <p class="prompt-block__text">Select a task in the main window to control the timer from here.</p>
        <button id="openMainWindow" class="link-button link-button--filled">Open Main Window</button>
      </div>

      <!-- Control Buttons -->
      <div id="controlGroup" class="control-group hidden">
        <div class="timer-button-group">
          <button id="startButton" class="timer-button timer-button--start">
            Start
          </button>
          <button id="stopButton" class="timer-button timer-button--stop hidden">
            Stop
          </button>
        </div>
        <button id="viewTaskDetails" class="link-button">
          Open main window for full controls →
        </button>
      </div>
    </div>
  </div>

  <script type="module" src="../renderer/menuBarPopup.js"></script>
  <script>
    // Theme sync with main window
    (async () => {
      // Get initial theme from main process
      const theme = await window.electronAPI.getTheme();
      document.documentElement.setAttribute('data-theme', theme);
      
      // Listen for theme changes
      window.electronAPI.onThemeChange((newTheme) => {
        document.documentElement.setAttribute('data-theme', newTheme);
      });
    })();
  </script>
</body>
</html>
